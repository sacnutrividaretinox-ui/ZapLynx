<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Conex√£o</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h2>Conex√£o</h2>

    <!-- Conectar via QR Code -->
    <div class="card">
      <h3>üì≤ Conectar via QR Code</h3>
      <button id="btnQr" class="btn">Gerar QR Code</button>
      <div id="qrCodeArea" class="qr-area">
        <p id="qrMessage">‚ö† Nenhum QR retornado</p>
        <img id="qrImage" src="" alt="QR Code" style="display:none; max-width:200px; margin-top:10px;">
      </div>
    </div>

    <!-- Conectar com N√∫mero -->
    <div class="card">
      <h3>üìû Conectar com n√∫mero</h3>
      <input type="text" id="phoneNumber" placeholder="Digite o n√∫mero (com DDI)">
      <button id="btnConnectNumber" class="btn">Conectar N√∫mero</button>
      <p id="statusNumber" class="status">‚ùå N√£o conectado</p>
    </div>
  </div>

  <script>
    // Gerar QR Code
    document.getElementById("btnQr").addEventListener("click", async () => {
      const qrMessage = document.getElementById("qrMessage");
      const qrImage = document.getElementById("qrImage");

      qrMessage.textContent = "‚è≥ Gerando QR Code...";
      qrImage.style.display = "none";

      try {
        const response = await fetch("/api/qrcode"); // ‚úÖ rota corrigida
        if (!response.ok) throw new Error("Erro ao gerar QR Code");

        const data = await response.json();
        if (data.qr) {
          qrImage.src = data.qr;
          qrImage.style.display = "block";
          qrMessage.textContent = "";
        } else {
          qrMessage.textContent = "‚ö† Nenhum QR retornado";
        }
      } catch (error) {
        console.error("Erro:", error);
        qrMessage.textContent = "‚ùå Erro ao gerar QR Code";
      }
    });

    // Conectar N√∫mero
    document.getElementById("btnConnectNumber").addEventListener("click", async () => {
      const phone = document.getElementById("phoneNumber").value.trim();
      const status = document.getElementById("statusNumber");

      if (!phone) {
        status.textContent = "‚ö† Digite um n√∫mero v√°lido";
        status.style.color = "orange";
        return;
      }

      status.textContent = "‚è≥ Conectando...";
      status.style.color = "yellow";

      try {
        const response = await fetch("/api/connect-number", { // ‚úÖ rota correta
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ phone }),
        });

        const data = await response.json();
        if (data.success) {
          status.textContent = "‚úÖ Conectado: " + phone;
          status.style.color = "lightgreen";
        } else {
          status.textContent = "‚ùå Falha ao conectar";
          status.style.color = "red";
        }
      } catch (error) {
        console.error("Erro:", error);
        status.textContent = "‚ùå Erro ao conectar n√∫mero";
        status.style.color = "red";
      }
    });
  </script>
</body>
</html>
