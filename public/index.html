<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ZapLynx üöÄ</title>
  <style>
    body { font-family: Arial, sans-serif; background: #0b1221; color: white; text-align: center; }
    .card { background: #1c253c; padding: 20px; margin: 20px auto; border-radius: 12px; width: 350px; }
    input, select, button { margin: 8px; padding: 10px; border-radius: 8px; border: none; width: 90%; }
    button { background: #28a745; color: white; cursor: pointer; font-weight: bold; }
    button:hover { background: #218838; }
    img { margin-top: 10px; max-width: 250px; }
    .msg { font-size: 14px; margin-top: 8px; }
  </style>
</head>
<body>
  <h1>ZapLynx üöÄ</h1>

  <div class="card">
    <h2>Conectar WhatsApp</h2>
    <select id="mode">
      <option value="qr">QR Code</option>
      <option value="pairing">N√∫mero (Pairing Code)</option>
    </select>
    <input type="text" id="phoneConnect" placeholder="Digite o n√∫mero (com DDI/DDD)" style="display:none;">
    <button onclick="connect()">Conectar</button>
    <div id="connectResult" class="msg"></div>
    <div id="qrContainer"></div>
  </div>

  <div class="card">
    <h2>Enviar Mensagem</h2>
    <input type="text" id="phone" placeholder="N√∫mero (com DDI/DDD)">
    <textarea id="message" placeholder="Digite sua mensagem"></textarea>
    <button onclick="sendMessage()">Enviar</button>
    <div id="result" class="msg"></div>
  </div>

  <script>
    const modeSelect = document.getElementById("mode");
    const phoneInput = document.getElementById("phoneConnect");

    modeSelect.addEventListener("change", () => {
      phoneInput.style.display = modeSelect.value === "pairing" ? "block" : "none";
    });

    async function connect() {
      const mode = modeSelect.value;
      const connectResult = document.getElementById("connectResult");
      const qrContainer = document.getElementById("qrContainer");
      qrContainer.innerHTML = "";
      connectResult.innerText = "Aguardando resposta...";

      try {
        if (mode === "qr") {
          const res = await fetch("/api/qrcode");
          const data = await res.json();
          if (data.qrCode) {
            qrContainer.innerHTML = `<img src="data:image/png;base64,${data.qrCode}" alt="QR Code">`;
            connectResult.innerText = "‚úÖ QR Code gerado!";
          } else {
            connectResult.innerText = "‚ö†Ô∏è Nenhum QR retornado.";
          }
        } else {
          const phone = document.getElementById("phoneConnect").value.trim();
          const res = await fetch("/api/pairing", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ phone })
          });
          const data = await res.json();
          if (data.pairingCode) {
            connectResult.innerText = "‚úÖ Pairing Code: " + data.pairingCode;
          } else {
            connectResult.innerText = "‚ö†Ô∏è Nenhum c√≥digo retornado.";
          }
        }
      } catch (err) {
        connectResult.innerText = "‚ùå Erro na conex√£o.";
        console.error(err);
      }
    }

    async function sendMessage() {
      const phone = document.getElementById("phone").value.trim();
      const message = document.getElementById("message").value.trim();
      const result = document.getElementById("result");
      result.innerText = "Aguardando envio...";

      try {
        const res = await fetch("/api/send", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ phone, message })
        });
        const data = await res.json();
        result.innerText = "‚úÖ Mensagem enviada!";
      } catch (err) {
        result.innerText = "‚ùå Erro ao enviar mensagem.";
        console.error(err);
      }
    }
  </script>
</body>
</html>
