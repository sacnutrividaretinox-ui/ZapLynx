<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ZapLynx 🚀</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>ZapLynx 🚀</h1>

  <!-- Conectar WhatsApp -->
  <section>
    <h2>Conectar WhatsApp</h2>
    <input type="text" id="instanceName" placeholder="Nome da instância">
    <input type="text" id="instanceDesc" placeholder="Descrição">
    <button onclick="addInstance()">Criar Instância</button>
    <p id="connectStatus"></p>
  </section>

  <hr>

  <!-- Enviar Mensagem -->
  <section>
    <h2>Enviar Mensagem</h2>
    <input type="text" id="phone" placeholder="Número com DDI/DD">
    <textarea id="message" placeholder="Digite sua mensagem"></textarea>
    <button onclick="sendMessage()">Enviar</button>
    <p id="sendStatus"></p>
  </section>

  <hr>

  <!-- Histórico -->
  <section>
    <h2>📜 Histórico de Mensagens</h2>
    <button onclick="loadMessages()">🔄 Atualizar Histórico</button>
    <ul id="messageList"></ul>
  </section>

  <script>
    // Criar instância
    async function addInstance() {
      const nome = document.getElementById("instanceName").value;
      const descricao = document.getElementById("instanceDesc").value;

      const res = await fetch("/instancia", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ nome, descricao })
      });

      const data = await res.json();
      document.getElementById("connectStatus").innerText = "Instância criada!";
      console.log(data);
    }

    // Enviar mensagem
    async function sendMessage() {
      const phone = document.getElementById("phone").value;
      const message = document.getElementById("message").value;

      const res = await fetch("/send", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ phone, message })
      });

      const data = await res.json();
      document.getElementById("sendStatus").innerText = "Mensagem enviada!";
      console.log(data);

      loadMessages(); // Atualiza o histórico automaticamente
    }

    // Carregar histórico
    async function loadMessages() {
      const res = await fetch("/mensagens");
      const mensagens = await res.json();

      const list = document.getElementById("messageList");
      list.innerHTML = "";
      mensagens.forEach(msg => {
        const li = document.createElement("li");
        li.innerText = `${msg.phone}: ${msg.message} (enviado em ${new Date(msg.enviadoEm).toLocaleString()})`;
        list.appendChild(li);
      });
    }

    // Carregar histórico ao abrir a página
    loadMessages();
  </script>
</body>
</html>
